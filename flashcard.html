<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="ui.css">
  <title>Flashcard</title>
</head>
<body>

<div class="container">

  <div class="card" id="card">
    <div id="word" class="text-large"></div>

    <div id="hint" style="margin-top:12px; color: var(--subtext);">
      タップで答えを表示
    </div>

    <div id="answer" class="hidden" style="margin-top:14px; text-align:left;">
      <div style="font-size:18px; font-weight:bold;" id="meaning"></div>
      <div style="margin-top:8px; color: var(--subtext);" id="example"></div>
    </div>
  </div>

  <div class="grid-2 mt-20">
    <button id="btn-remember" class="btn-primary" disabled>覚えた</button>
    <button id="btn-unsure" class="btn-outline" disabled>怪しい</button>
  </div>

  <button id="btn-forgot"
          class="btn-primary mt-20"
          style="background: var(--danger); width:100%;"
          disabled>忘れた</button>

</div>

<script src="data.js"></script>
<script src="srs.js"></script>

<script>

let current = null;
let revealed = false;

const elCard = document.getElementById("card");
const elWord = document.getElementById("word");
const elHint = document.getElementById("hint");
const elAnswer = document.getElementById("answer");
const elMeaning = document.getElementById("meaning");
const elExample = document.getElementById("example");

const btnRemember = document.getElementById("btn-remember");
const btnUnsure = document.getElementById("btn-unsure");
const btnForgot = document.getElementById("btn-forgot");

function setButtonsEnabled(on) {
  btnRemember.disabled = !on;
  btnUnsure.disabled = !on;
  btnForgot.disabled = !on;
}

function hideAnswer() {
  revealed = false;
  elAnswer.classList.add("hidden");
  elHint.classList.remove("hidden");
  setButtonsEnabled(false);
}

function showAnswer() {
  revealed = true;
  elAnswer.classList.remove("hidden");
  elHint.classList.add("hidden");
  setButtonsEnabled(true);
}

function renderCard(wordObj) {
  current = wordObj;
  elWord.textContent = wordObj.word;
  elMeaning.textContent = wordObj.meaning;
  elExample.textContent = wordObj.example;
  hideAnswer();
}

elCard.addEventListener("click", () => {
  if (!revealed) showAnswer();
});

btnRemember.addEventListener("click", () => {
  SRS.recordResult(current.id, true);
  renderCard(SRS.getNextWord(current.id));
});

btnUnsure.addEventListener("click", () => {
  SRS.recordResult(current.id, false);
  renderCard(SRS.getNextWord(current.id));
});

btnForgot.addEventListener("click", () => {
  SRS.recordResult(current.id, false);
  renderCard(SRS.getNextWord(current.id));
});

renderCard(SRS.getNextWord());

</script>

</body>
</html>