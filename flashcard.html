<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="ui.css">
  <title>Flashcards - TOEIC 700 SRS</title>
  <style>
    #version-tag{font-size:10px;opacity:.7;position:fixed;top:10px;right:10px}
    #card{min-height:240px;display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:pointer}
    #answer{width:100%;margin-top:18px;padding-top:18px;border-top:1px dashed #444}
    #meaning{font-size:1.4rem;font-weight:700;margin-bottom:8px}
    #example{font-size:.95rem;opacity:.85;font-style:italic}
    button:disabled{opacity:.35;cursor:not-allowed}
    .btn-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  </style>
</head>
<body>
  <div id="version-tag">FLASHCARD v3</div>

  <div class="container">
    <button class="btn-main" onclick="location.href='index.html'" style="width:auto;margin-bottom:12px">← 戻る</button>

    <div class="card" id="card">
      <div id="word" class="text-large">読み込み中...</div>

      <div id="tap-hint" style="margin-top:14px;font-size:12px;opacity:.7;">
        タップで答えを表示
      </div>

      <div id="answer" class="hidden">
        <div id="meaning"></div>
        <div id="example"></div>
      </div>
    </div>

    <div style="margin-top:14px;display:grid;gap:10px;">
      <button id="btn-known" class="btn-main" disabled>覚えた</button>
      <div class="btn-row">
        <button id="btn-unsure" class="btn-main" disabled>怪しい</button>
        <button id="btn-forgot" class="btn-main" disabled style="background:#dc3545">忘れた</button>
      </div>
    </div>
  </div>

  <script src="data.js"></script>
  <script src="srs.js"></script>
  <script>
    let current = null;
    let revealed = false;

    const dom = {
      card: document.getElementById('card'),
      word: document.getElementById('word'),
      hint: document.getElementById('tap-hint'),
      answer: document.getElementById('answer'),
      meaning: document.getElementById('meaning'),
      example: document.getElementById('example'),
      known: document.getElementById('btn-known'),
      unsure: document.getElementById('btn-unsure'),
      forgot: document.getElementById('btn-forgot'),
    };

    function setBtns(on){
      dom.known.disabled = !on;
      dom.unsure.disabled = !on;
      dom.forgot.disabled = !on;
    }

    function render(wordObj){
      current = wordObj;
      revealed = false;

      dom.word.textContent = wordObj ? wordObj.word : "学習対象がありません";
      dom.meaning.textContent = wordObj ? wordObj.meaning : "";
      dom.example.textContent = wordObj ? wordObj.example : "";

      dom.answer.classList.add('hidden');
      dom.hint.classList.remove('hidden');
      setBtns(false);
    }

    function reveal(){
      if(!current || revealed) return;
      revealed = true;
      dom.answer.classList.remove('hidden');
      dom.hint.classList.add('hidden');
      setBtns(true);
    }

    function next(){
      const n = SRS.getNextWord(current ? current.id : null);
      render(n);
    }

    function answer(isCorrect){
      if(!current || !revealed) return;
      SRS.recordResult(current.id, isCorrect);
      next();
    }

    dom.card.addEventListener('click', reveal);

    dom.known.addEventListener('click', () => answer(true));
    dom.unsure.addEventListener('click', () => answer(false));
    dom.forgot.addEventListener('click', () => answer(false));

    window.onload = () => {
      try { next(); } catch(e) { dom.word.textContent = "エラー: " + e.message; }
    };
  </script>
</body>
</html>