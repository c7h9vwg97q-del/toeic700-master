<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="ui.css">
<title>Weak Mode</title>
</head>
<body>

<div class="container">

<button onclick="location.href='index.html'" class="btn-outline">â† æˆ»ã‚‹</button>

<div id="main">
  <div class="card" id="card">
    <div id="word" class="text-large">Loading...</div>

    <div id="answer" class="hidden">
      <div id="meaning"></div>
      <div id="example"></div>
    </div>

    <div id="hint">ã‚¿ãƒƒãƒ—ã§ç­”ãˆã‚’è¡¨ç¤º</div>
  </div>

  <div style="margin-top:20px;">
    <button id="btn-known" disabled>è¦šãˆãŸ</button>
    <button id="btn-unsure" disabled>æ€ªã—ã„</button>
    <button id="btn-forgot" disabled>å¿˜ã‚ŒãŸ</button>
  </div>
</div>

<div id="empty" class="hidden">
  ğŸ‰ å¼±ç‚¹å˜èªãªã—
</div>

</div>

<script src="data.js"></script>
<script src="srs.js"></script>

<script>
let current = null;
let revealed = false;
let weakList = [];

const el = {
  card: document.getElementById("card"),
  word: document.getElementById("word"),
  meaning: document.getElementById("meaning"),
  example: document.getElementById("example"),
  answer: document.getElementById("answer"),
  hint: document.getElementById("hint"),
  btnKnown: document.getElementById("btn-known"),
  btnUnsure: document.getElementById("btn-unsure"),
  btnForgot: document.getElementById("btn-forgot"),
  main: document.getElementById("main"),
  empty: document.getElementById("empty")
};

function safeCheck() {
  if (!window.wordData) return false;
  if (!window.SRS) return false;
  return true;
}

function buildWeak() {
  const stats = SRS.getStats();
  weakList = wordData.filter(w => {
    const s = stats[w.id];
    if (!s) return false;
    const total = (s.correct || 0) + (s.wrong || 0);
    if (total === 0) return false;
    return (s.correct / total) < 0.7;
  });
}

function nextWord() {
  if (weakList.length === 0) {
    el.main.classList.add("hidden");
    el.empty.classList.remove("hidden");
    return;
  }

  const index = Math.floor(Math.random() * weakList.length);
  current = weakList[index];
  revealed = false;

  el.word.innerText = current.word;
  el.meaning.innerText = current.meaning;
  el.example.innerText = current.example;

  el.answer.classList.add("hidden");
  el.hint.classList.remove("hidden");

  el.btnKnown.disabled = true;
  el.btnUnsure.disabled = true;
  el.btnForgot.disabled = true;
}

function reveal() {
  if (!current || revealed) return;
  revealed = true;

  el.answer.classList.remove("hidden");
  el.hint.classList.add("hidden");

  el.btnKnown.disabled = false;
  el.btnUnsure.disabled = false;
  el.btnForgot.disabled = false;
}

function answer(isCorrect) {
  if (!current || !revealed) return;

  SRS.recordResult(current.id, isCorrect);
  buildWeak();
  nextWord();
}

el.card.onclick = reveal;
el.btnKnown.onclick = () => answer(true);
el.btnUnsure.onclick = () => answer(false);
el.btnForgot.onclick = () => answer(false);

window.onload = function() {
  if (!safeCheck()) {
    document.body.innerHTML = "data.js ã¾ãŸã¯ srs.js ãŒèª­ã¿è¾¼ã‚ã¦ã„ã¾ã›ã‚“";
    return;
  }
  buildWeak();
  nextWord();
};
</script>

</body>
</html>